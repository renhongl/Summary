## Javascript设计模式与开发实践重点

### 鸭子类型

如果它走起来像鸭子，叫起来也像鸭子，那么它就是鸭子。

### 多态

多态最根本的作用就是通过把过程化的条件分支语句转化为对象的多态性，从而消除这些条件分支语句。

### 原型模式

类并不是必须的，对象未必需要从类中创建而来，一个对象是通过克隆另外一个对象所得到的。

原型模式不但是一种设计模式，也被称为一种编程泛型。

ECMAScript5提供了Object.create方法，可以用来克隆对象。

但是create方法性能不如 var obj = {} 或者 var obj = new Object();

以上两种替代方式，内部都是克隆原型而得到对象。

**注：** Javascript中的根对象是Object，所有的对象都从根对象克隆而来。

### 闭包

闭包是一个非常强大的特性，但人们对其也有诸多误解。一种耸人听闻的说法是闭包会造成内存泄漏，所以要尽量减少闭包的使用。

局部变量本来应该在函数退出的时候被解除饮用，但如果局部变量被封闭在闭包形成的环境中，那么这个局部变量就能一直生存下去。从这个意义上看，闭包的确会使一些数据无法被及时销毁。使用闭包的一部分原因是我们选择主动把一些变量封闭在闭包中，因为可能在以后还需要使用这些变量，把这些变量放在闭包中和放在全局作用域，对内存方面的影响是一致的。


跟闭包和内存泄漏有关系的地方是，使用闭包的同时，比较容易形成循环引用，如果闭包的作用域链中保存着一些DOM节点，这时候有可能造成内存泄漏。但这并非闭包问题，也并非Javascript问题。

**注：** 当代码中需要全局变量时，可以使用闭包，将这个变量封装在一个函数中，那这个函数就封装了一个独立的功能，不再依赖外部的变量。

### 函数柯里化（function currying）

currying又称部分求值。一个currying的函数首先会接受一些参数，接受了这些参数之后，该函数并不会立即求值，而是继续返回另外一个函数，刚传入的参数在函数形成的闭包中被保存起来。待到函数真正需要求值的时候，之前传入的所有参数都会被一次性用于求值。

### uncurrying

当我们调用对象的某个方法时，其实不用去关心该对象原本是否被设计为拥有这个方法，这是动态类型语言的特点，也是常说的鸭子类型思想。

同理，一个对象也未必只有使用它自身的方法。通过call和apply方法可以让对象去借用一个原本不属于它的方法。


### 函数节流

在一些情况下，函数的触发不是由用户直接控制的，在这些情景下，函数可能被非常频繁的调用，而造成大的性能问题。

例如在window的resize事件中，或者在div拖动事件中，会频繁的触发这些事件，并且DOM相关的操作非常消耗性能，这时浏览器可能会出现卡顿现象。

以上现象我们可以使用setTimeout来实现每隔固定时间来触发事件，如果过于频繁，将忽略那次的事件。

代码流程：

    var resize = function(callback, interval) {
        var timer,
            firstTime = true;
        return function() {
            var args = arguments,
                self = this;
            if(firstTime) {
                callback.apply(self, args);
                return false;
            }
            if(timer) {
                return false;
            }
            timer = setTimeout(function() {
                clearTimeout(timer);
                timer = null;
                callback.apply(self, args);
            }, interval || 500)
        }
    };

    window.onresize = resize(function() {
        console.log('resized', Date.now());
    }, 1000);


### 分时函数

比如在加载QQ列表时，需要增加成百上千个DOM节点作为好友，在短时间内添加大量DOM也会让浏览器卡顿，我们可以使用分批进行的方法，比如一秒创建1000个节点，改为每隔200毫秒创建10个节点。